<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Heart Function</title>
    <style>
        body {
            background-color: #000;
            color: #ff4d4d;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
            text-shadow: 0 0 10px #ff0000;
            font-weight: normal;
            letter-spacing: 2px;
        }

        #canvas-container {
            position: relative;
            /* box-shadow: 0 0 20px rgba(255, 0, 0, 0.2); */
            /* border: 1px solid #333; */
            border-radius: 8px;
            /* background-color: #050505; */
        }

        canvas {
            display: block;
            cursor: crosshair;
        }

        .controls {
            margin-top: 30px;
            width: 80%;
            max-width: 600px;
            text-align: center;
            background: rgba(20, 20, 20, 0.8);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #333;
        }

        .slider-container {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        input[type=range] {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #ff4d4d;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px #ff0000;
            transition: transform 0.1s;
        }

        input[type=range]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .math-display {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: #ff4d4d;
        }

        #k-value {
            font-weight: bold;
        }
        
        .equation {
            margin-top: 5px;
            color: #888;
            font-size: 1.1rem;
            font-style: italic;
            opacity: 0.8;
        }

        /* Axis labels */
        .axis-label {
            position: absolute;
            color: #888;
            font-size: 12px;
            pointer-events: none;
        }
    </style>
</head>
<body>

    <h1>Happy Valentines!</h1>

    <div id="canvas-container">
        <canvas id="heartCanvas" width="600" height="500"></canvas>
    </div>

    <div class="controls">
        <div class="math-display">
            k = <span id="k-value">86.30</span>
        </div>
        <div class="slider-container">
            <input type="range" id="kSlider" min="0" max="150" step="0.1" value="86.3">
        </div>
        <div class="equation">
            y = x<sup>2/3</sup> + 0.9 sin(kx) &radic;(3 - x<sup>2</sup>)
        </div>
    </div>

    <script>
        const canvas = document.getElementById('heartCanvas');
        const ctx = canvas.getContext('2d');
        const slider = document.getElementById('kSlider');
        const kValueDisplay = document.getElementById('k-value');

        // Configuration
        // Zoom level - adjust based on canvas size
        const scale = 130; 
        const offsetX = canvas.width / 2;
        // Shift down slightly to center the heart vertically in the canvas
        const offsetY = canvas.height / 2 + 20; 

        function drawAxes() {
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 1;
            ctx.font = "12px monospace";
            ctx.fillStyle = "#888";
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(0, offsetY);
            ctx.lineTo(canvas.width, offsetY);
            ctx.stroke();

            // Y-axis
            ctx.beginPath();
            ctx.moveTo(offsetX, 0);
            ctx.lineTo(offsetX, canvas.height);
            ctx.stroke();

            // Arrows
            // X Arrow
            ctx.beginPath();
            ctx.moveTo(canvas.width - 10, offsetY - 5);
            ctx.lineTo(canvas.width, offsetY);
            ctx.lineTo(canvas.width - 10, offsetY + 5);
            ctx.fillStyle = "#ccc";
            ctx.fill();

            // Y Arrow
            ctx.beginPath();
            ctx.moveTo(offsetX - 5, 10);
            ctx.lineTo(offsetX, 0);
            ctx.lineTo(offsetX + 5, 10);
            ctx.fill();

            // Ticks and Labels
            // X ticks: -2, -1, 1, 2
            const xTicks = [-2, -1, 1, 2];
            xTicks.forEach(val => {
                const xPos = offsetX + val * scale;
                ctx.beginPath();
                ctx.moveTo(xPos, offsetY - 3);
                ctx.lineTo(xPos, offsetY + 3);
                ctx.stroke();
                ctx.fillText(val, xPos - 4, offsetY + 15);
            });

            // Y ticks: -1, 1, 2
            const yTicks = [-1, 1, 2];
            yTicks.forEach(val => {
                const yPos = offsetY - val * scale;
                ctx.beginPath();
                ctx.moveTo(offsetX - 3, yPos);
                ctx.lineTo(offsetX + 3, yPos);
                ctx.stroke();
                ctx.fillText(val, offsetX - 15, yPos + 4);
            });
        }

        function drawHeart(k) {
            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            drawAxes();

            // Draw the Heart Graph
            ctx.beginPath();
            ctx.strokeStyle = '#ff3333';
            // Slight glow effect
            ctx.shadowColor = '#ff0000';
            ctx.shadowBlur = 5; 
            ctx.lineWidth = 1.5;

            // The domain of x is [-sqrt(3), sqrt(3)] approx [-1.732, 1.732]
            // We need high resolution for the high frequency waves to look good
            const limit = Math.sqrt(3);
            // Dynamic step size: lower step size (higher resolution) as K increases prevents aliasing artifacts
            const step = 0.0005; 

            let firstPoint = true;

            for (let x = -limit; x <= limit; x += step) {
                // The Formula:
                // y = x^(2/3) + 0.9 * sin(k*x) * sqrt(3 - x^2)
                
                // Math.pow(x, 2/3) implementation detail:
                // JS Math.pow can return NaN for negative bases with fractional exponents.
                // Since x^(2/3) = (x^2)^(1/3) = cbrt(x^2), the term is always positive.
                const xSquared = x * x;
                const term1 = Math.cbrt(xSquared); // Cube root of x squared
                
                const term2 = 0.9 * Math.sin(k * x) * Math.sqrt(3 - xSquared);
                
                const y = term1 + term2;

                // Transform to canvas coordinates
                // Canvas Y is inverted (0 is at top), so we subtract y from offsetY
                const screenX = offsetX + (x * scale);
                const screenY = offsetY - (y * scale);

                if (firstPoint) {
                    ctx.moveTo(screenX, screenY);
                    firstPoint = false;
                } else {
                    ctx.lineTo(screenX, screenY);
                }
            }
            ctx.stroke();
            
            // Reset shadow for next frame performance
            ctx.shadowBlur = 0;
        }

        // Initial Draw
        drawHeart(slider.value);

        // Event Listener for Slider
        slider.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            // Update display text
            kValueDisplay.textContent = val.toFixed(2);
            // Redraw
            requestAnimationFrame(() => drawHeart(val));
        });
    </script>
</body>
</html>
